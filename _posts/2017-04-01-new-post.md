---
layout: post
title: "View的绘制源码学习总结"
categories:
- Android
tags:
- View


---


##前言

算是第一篇正式的github博文，回顾了一下之前看过的view源码解析，做一个对目前为止View学习小的总结。

我觉得对于源码的解析和学习，把所有流程记下来意义并不是很大，最关键的是：

1.知道基本作用和用法
2.大概了解整个流程和实现方法
3.了解里面可扩展的地方在哪，更灵活地使用
4.整个源码设计和细节有没有什么亮点值得参考和学习
5.源码设计的思路

这也是写这篇文章的目的所在。

##View的绘制

####LayoutInflater

http://www.cnblogs.com/qlky/p/5674975.html

- **作用**

LayoutInflater是用来加载布局的，我们最简单的代码：

```
protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.mainlayout);
}
```

中的setContentView就是用LayoutInflater实现的

- **用法**

可以用来动态加载布局
```
	LayoutInflater layoutInflater = LayoutInflater.from(this);
        View buttonlayout = layoutInflater.inflate(R.layout.button_layout,null);
        mainlayout.addView(buttonlayout);
```

- **原理**

inflate是用pull来解析xml格式的，其中调用了createViewFromTag()这个方法，并把节点名和参数传了进去。看到这个方法名，我们就应该能猜到，它是用于根据节点名来创建View对象的。
确实如此，在createViewFromTag()方法的内部又会去调用createView()方法，然后使用反射的方式创建出View的实例并返回。

对于布局子元素会用rinflate()去循环实现。

- **拓展**

从源码可以知道

public View inflate(XmlPullParser parser, ViewGroup root, boolean attachToRoot)的第三个参数attachToRoot

1. 如果root为null，attachToRoot将失去作用，设置任何值都没有意义。

2. 如果root不为null，attachToRoot设为true，则会给加载的布局文件的指定一个父布局，即root。

3. 如果root不为null，attachToRoot设为false，则会将布局文件最外层的所有layout属性进行设置，当该view被添加到父view当中时，这些layout属性会自动生效。

4. 在不设置attachToRoot参数的情况下，如果root不为null，attachToRoot参数默认为true。


所有控件的layout_width等属性，都要有一个父布局才能生效，因为这是用来设置view在布局中的大小，而不是view的大小，所以叫layout_width，不是width。

而LinearLayout的layout_width有效是因为，在setContentView()方法中，Android会自动在布局文件的最外层再嵌套一个FrameLayout，id为content

所以叫setContentView()，其实这个方法也是用Layoutlnflater()实现的